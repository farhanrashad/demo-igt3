<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- inherit task form view -->
        <record id="view_task_form2_inherit_job_order" model="ir.ui.view">
            <field name="name">view.task.form2.inherit.job.order</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_form2" />
            <field name="arch" type="xml">
                <xpath expr="//div[@name='button_box']" position="inside">
                    <button class="oe_stat_button" type="action" name="%(act_project_task_note_all)d" icon="fa-pencil-square-o">
                        <field string="Notes" name="task_notes_count" widget="statinfo" />

                    </button>
                 
                </xpath>
                
                <xpath expr="//page[@name='extra_info']/group[1]/group[1]" position="inside">
                    <field name="location_id" />
                    <field name="is_job_order" />
                </xpath>
                <xpath expr="//page[@name='description_page']" position="after">
                    <page name='material_planing' string='Material Planning' attrs="{'invisible': [('is_job_order', '!=', True)]}">
                        <field name="job_order_boq_line" widget="one2many_list">
                            <tree string="BOQ lines" editable="bottom">
                                <field name="product_id"/>
                                <field name="product_template_id" invisible="1"/>
                                <field name="name"/>
                                <field name="product_uom_qty"/>
                                <field name="product_uom"/>
                                <field name="product_uom_category_id" invisible="1"/>
                            </tree>
                        </field>
                    </page>
                    <!--
                    <page name='boq' string="BOQ" attrs="{'invisible': [('is_job_order', '!=', True)]}">
                            <field name="requisition_ids" widget="many2many" />
                                
                        </page>
                   
                    <page name='stock_moves' string="Stock Moves" attrs="{'invisible': [('is_job_order', '!=', True)]}">
                        <field name="stock_move" widget="many2many" >
                            <tree string="Stock Moves" >
                                <field name="reference" />
                                <field name="origin" />
                                <field name="product_id" />
                                <field name="quantity_done" />
                                <field name="location_id" />
                                <field name="location_dest_id" />
                                <field name="state" />
                            </tree>
                        </field>
                    </page>
                    
                    <page name='material_consumption' string="Material Consumption" attrs="{'invisible': [('is_job_order', '!=', True)]}">
                        <field name="move_raw_ids" context="{'default_product_uom_qty': 1.0, 'default_date': date_deadline, 'default_date_deadline': date_deadline, 'default_location_id': location_id, 'default_location_dest_id': location_id, 'default_state': 'draft', 'default_picking_type_id': 1, 'default_company_id': company_id}" attrs="{'readonly': [('is_job_order', '!=', True)]}" options="{'delete': [('is_closed', '!=', True)]}">
                            <tree default_order="is_done,sequence" editable="bottom">
                                <field name="product_id" force_save="1" required="1" context="{'default_type': 'product'}" />
                                <field name="move_line_ids" invisible="1">
                                        <tree>
                                            <field name="lot_id" invisible="1"/>
                                            <field name="owner_id" invisible="1"/>
                                            <field name="package_id" invisible="1"/>
                                            <field name="result_package_id" invisible="1"/>
                                            <field name="location_id" invisible="1"/>
                                            <field name="location_dest_id" invisible="1"/>
                                            <field name="qty_done" invisible="1"/>
                                            <field name="product_id" invisible="1"/>
                                            <field name="product_uom_id" invisible="1"/>
                                            <field name="product_uom_qty" invisible="1"/>
                                            <field name="state" invisible="1"/>
                                            <field name="move_id" invisible="1"/>
                                            <field name="id" invisible="1"/>
                                        </tree>
                                    </field>
                                 <field name="company_id" invisible="1"/>
                                    <field name="product_uom_category_id" invisible="1"/>
                                    <field name="name" invisible="1"/>
                                    <field name="date_deadline" invisible="1"/>
                                    <field name="date" invisible="1"/>
                                    <field name="additional" invisible="1"/>
                                    <field name="picking_type_id" invisible="1"/>
                                    <field name="has_tracking" invisible="1"/>
                                    <field name="sequence" invisible="1"/>
                                    <field name="location_id" invisible="1"/>
                                    <field name="warehouse_id" invisible="1"/>
                                    <field name="has_move_lines" invisible="1"/>
                                    <field name="location_dest_id" invisible="1"/>
                                    <field name="state" invisible="1" force_save="1"/>
                                <field name="product_uom_qty" invisible="1" readonly="1"/>
                                <field name="product_type" invisible="1"/>
                                    <field name="product_qty" invisible="1" readonly="1"/>
                                    <field name="reserved_availability" invisible="1"/>
                                    <field name="forecast_expected_date" invisible="1"/>
                                <field name="quantity_done" />
                                <field name="product_uom" />
                                <field name="has_tracking" invisible="1"/>
                                <field name="show_details_visible" invisible="1"/>


                                <field name="lot_ids" widget="many2many_tags" attrs="{'invisible': ['|', ('show_details_visible', '=', False), ('has_tracking', '!=', 'serial')]}" />
                                    <button name="action_show_details" type="object" icon="fa-list" context="{'default_product_uom_qty': 0}" options="{&quot;warn&quot;: true}" attrs="{'invisible': ['|', ('show_details_visible', '=', False), ('has_tracking', '!=', 'serial')]}" />

                            </tree>
                            
                        </field>
                        
                    </page>
                    -->
                </xpath>
            </field>
        </record>
        
        <record id="action_view_all_job_orders" model="ir.actions.act_window">
            <field name="name">Job Orders</field>
            <field name="res_model">project.task</field>
            <field name="view_mode">tree,kanban,form,calendar,pivot,graph,activity</field>
            <field name="context">{'search_default_my_tasks': 1, 'all_task': 0, 'is_job_order': '1'}</field>
            <field name="domain">[('is_job_order','=', True)]</field>
            <field name="search_view_id" ref="project.view_task_search_form"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No job orders found. Let's create one!
                </p>
            </field>
        </record>
        
        <menuitem name="Job Order" id="project_planning_job_order_menu" parent="project_planning_ops_main_menu" action="action_view_all_job_orders" sequence="20" groups="base.group_no_one,project.group_project_user"/>
        
    </data>
</odoo>